<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="HJW"><meta name="copyright" content="HJW"><title>HJW</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3a101c3aa7d1cde834d9d6b197500902";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-139524382-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://avatars0.githubusercontent.com/u/17232182?s=460&amp;v=4"></div><div class="author-info__name text-center">HJW</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/hjwjw">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">88</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">62</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">22</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">HJW</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">HJW</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/posts/7b2ef2b/">六 Activiti5 数据库表简要分析</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Activiti/">Activiti</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/activiti/">activiti</a></span><div class="content"><blockquote>
<p>Activiti 将工作流程信息都存储在数据库表中，因此需要了解这些表的作用，能更好的帮助我们理解Activiti的工作方式。</p>
</blockquote>
<p><img src="https://wx4.sinaimg.cn/mw690/005RGBbLly1fwv4nov6fpj305i0ez74e.jpg" alt="这里写图片描述"></p>
<hr>
<p>*<em>ACT_RE_</em>: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</p>
<hr>
<p>ACT_RU_* : ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</p>
<hr>
<p>ACT_ID_*: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。</p>
<hr>
<p>ACT_HI_*: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</p>
<hr>
<p>ACT_GE_*: ‘GE’表示general。通用数据， 用于不同场景下，如存放资源文件。</p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/4104c51a/">五 Activiti5 任务管理</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Activiti/">Activiti</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Activiti/">Activiti</a></span><div class="content"><h3 id="办理任务"><a href="#办理任务" class="headerlink" title="办理任务"></a>办理任务</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">variables.put(<span class="string">"user"</span>, <span class="string">"admin"</span>);</span><br><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">processEngine.getTaskService()</span><br><span class="line">        .complete(<span class="string">"22505"</span>,variables);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Complete()中传入任务的ID，并传入下一个执行人参数</p>
</blockquote>
<h3 id="查看任务列表"><a href="#查看任务列表" class="headerlink" title="查看任务列表"></a>查看任务列表</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">List&lt;Task&gt; tasks = processEngine.getTaskService()</span><br><span class="line">        .createTaskQuery()</span><br><span class="line">        .taskAssignee(userName).list();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以查看指定用户的所有任务</p>
</blockquote>
<h3 id="查看指定任务信息"><a href="#查看指定任务信息" class="headerlink" title="查看指定任务信息"></a>查看指定任务信息</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Task t = processEngine.getTaskService()</span><br><span class="line">        .createTaskQuery()</span><br><span class="line">        .taskId(taskId)</span><br><span class="line">        .singleResult();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过任务ID查找到指定的任务。还需要添加一个singleResult(),表示返回单个结果</p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/abd3d7ab/">三 Activiti5 流程管理</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Activiti/">Activiti</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Activiti/">Activiti</a></span><div class="content"><h3 id="流程部署"><a href="#流程部署" class="headerlink" title="流程部署"></a>流程部署</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//得到一个默认的流程引擎</span></span><br><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">Deployment deployment = processEngine.getRepositoryService()</span><br><span class="line">        .createDeployment()</span><br><span class="line">        .addClasspathResource(<span class="string">"WeChat.bpmn"</span>)</span><br><span class="line">        .addClasspathResource(<span class="string">"WeChat.png"</span>)</span><br><span class="line">        .deploy();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>WeChat.bpmn 为我们设计好的流程图<br>流程部署有三种方式，请查看这篇《Activiti 部署的三种方式与部署查询流程查询源码》：<a href="http://blog.csdn.net/FTDD_HW/article/details/76551954" target="_blank" rel="noopener">http://blog.csdn.net/FTDD_HW/article/details/76551954</a></p>
</blockquote>
<h3 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">processEngine.getRuntimeService()</span><br><span class="line">        .startProcessInstanceByKey(pdkey,variables);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启动时我们可以根据key 来启动，也可以根据ID来启动。还可以带一些参数进行。Variables为一个Map集合.如果我们在流程中定义了变量，在启动前则需要将变量通过Map传递进行。</p>
</blockquote>
<h3 id="查看所有流程部署"><a href="#查看所有流程部署" class="headerlink" title="查看所有流程部署"></a>查看所有流程部署</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;ProcessDefinition&gt; processDefinition = processEngine.getRepositoryService()</span><br><span class="line">        .createProcessDefinitionQuery()</span><br><span class="line">        .list();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们需要一个list()来将结果转化成一个List集合，方便我们取值。</p>
</blockquote>
<h3 id="查看流程是否结束"><a href="#查看流程是否结束" class="headerlink" title="/查看流程是否结束"></a>/查看流程是否结束</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">ProcessInstance pi = processEngine.getRuntimeService()</span><br><span class="line">        .createProcessInstanceQuery()</span><br><span class="line">        .processInstanceId(<span class="string">"130001"</span>)</span><br><span class="line">        .singleResult();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果PI 的值为 null 则流程已经结果了</p>
</blockquote>
<h3 id="删除流程部署"><a href="#删除流程部署" class="headerlink" title="删除流程部署"></a>删除流程部署</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// processEngine.getRepositoryService()</span></span><br><span class="line"><span class="comment">// .deleteDeployment("1");//用该API只能删除流程定义的内容和部署的内容</span></span><br><span class="line">processEngine.getRepositoryService()</span><br><span class="line">        .deleteDeployment(<span class="string">"55001"</span>, <span class="keyword">true</span>);<span class="comment">//删除了关于deploymentID为1的所有的数据，包括：流程定义、流程部署、任务等信息</span></span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/605dbeac/">小程序开发的中遇到的坑</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/微信小程序/">微信小程序</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/微信小程序/">微信小程序</a></span><div class="content"><p>#text组件<br><img src="https://wx4.sinaimg.cn/mw690/005RGBbLly1fwv4nznibjj30on075q73.jpg" alt="这里写图片描述"></p>
<p>#wx:for<br>     是作用在wx:for所在的标签上开始的，循环内容包括该标签</p>
<p>#push<br>空数组push进数据之后，还需要用setData写入数据，不然原数据没变</p>
<p>#函数执行顺序<br>在page中各函数与语句执行的顺序不是从上到下，可能是同时。。<br>​     有时会出现已经设置数据了，但后面用的时候发现没有数据，可能的原因就是用数据在设置数据之前执行了，因此还没有数据。最好了设置数据后<br>紧接着用数据</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/191c72f9/">SpringMVC的配置步骤</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/spring-mvc/">spring mvc</a></span><div class="content"><h3 id="导入springmvc的JAR包"><a href="#导入springmvc的JAR包" class="headerlink" title="导入springmvc的JAR包"></a>导入springmvc的JAR包</h3><h3 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h3><h3 id="配置前端控制器"><a href="#配置前端控制器" class="headerlink" title="配置前端控制器"></a>配置前端控制器</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">  &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">  &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;!--指定配置文件 --&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">  &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br></pre></td></tr></table></figure>
<p>###配置servlet拦截方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">          &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">          &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;</span><br><span class="line">     &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置springmvc-xml-文件"><a href="#配置springmvc-xml-文件" class="headerlink" title="配置springmvc.xml.文件"></a>配置springmvc.xml.文件</h3><ul>
<li><p>配置组件扫描器，扫描controller,service,mapper等</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;cn.itcast.ssm.controller&quot;&gt;&lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>配置MVC注解驱动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置视图解析器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &lt;!-- ViewResolver --&gt;</span><br><span class="line">&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">&lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;</span><br><span class="line">&lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</span><br><span class="line">&lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="配置controller"><a href="#配置controller" class="headerlink" title="配置controller"></a>配置controller</h3><blockquote>
<p>加@controller  ,@requestMapping注解</p>
</blockquote>
<pre><code>@RequestMapping实现 对queryItems方法和url进行映射，一个方法对应一个url
</code></pre><h3 id="添加JSP文件"><a href="#添加JSP文件" class="headerlink" title="添加JSP文件"></a>添加JSP文件</h3><blockquote>
<p>在WebRoot/WEB-INF/jsp/items/itemsList.jsp<br>并在jsp页面中通过 key (itemsList) 来取出数据</p>
</blockquote>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/fc49410c/">一 Activiti5 配置</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Activiti/">Activiti</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Activiti/">Activiti</a></span><div class="content"><blockquote>
<p>Activiti5由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。</p>
</blockquote>
<h1 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h1><ul>
<li>JDK1.6或者更高版本</li>
<li>支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。</li>
<li>支持activiti5运行的jar包</li>
<li>开发环境为Eclipse3.7或者以上版本,MyEclipse为8.6版本</li>
</ul>
<h1 id="资源下载"><a href="#资源下载" class="headerlink" title="资源下载"></a>资源下载</h1><ul>
<li><a href="http://activiti.org/download.html" target="_blank" rel="noopener">Activiti下载</a></li>
<li><a href="http://pan.baidu.com/s/1qYgohFA" target="_blank" rel="noopener">流程设计器-Eclipse 插件-百度网盘下载</a>，密码：447q3 (插件安装教程:<a href="http://blog.csdn.net/qq_33547950/article/details/54926435" target="_blank" rel="noopener">http://blog.csdn.net/qq_33547950/article/details/54926435</a>)  </li>
</ul>
<h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><ul>
<li><p>导入JAR包</p>
<ul>
<li><p>手动导入</p>
<p>​我们在Eclipse中新建一个java项目，将Activiti需要的jar包导入。Activiti需要的jar包可以在从官网下载下来的Activiti文件中找到。路径：activiti-5.22.0\wars  下的示例项目activiti-rest.war 将其解压后，其中lib文件夹下的jar包就是我们所需要的。但其中没有给我们提供mysql的jar包与单元测试junit的jar包，我们自己添加即可。</p>
</li>
<li><p>Maven 依赖配置</p>
<p><strong>pom文件</strong></p>
<p>其中activiti支持与Spring的一些核心包是必须的，其它的按自己项目来增删即可。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--activiti --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activiti.version</span>&gt;</span>5.22.0<span class="tag">&lt;/<span class="name">activiti.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.0.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.2.6<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log4j日志文件管理包版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.7<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 映入JSON --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jackson-mapper-asl.version</span>&gt;</span>1.9.13<span class="tag">&lt;/<span class="name">jackson-mapper-asl.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.json-lib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>jdk15<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加jtl支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加Spring支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加日志支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加mybatis支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jdbc驱动包  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.37<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- apache公共包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-beanutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-beanutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-collections&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-logging&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.1.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.3.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- 添加Activiti支持 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;activiti-engine&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;5.22.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;activiti-bpmn-model&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;5.22.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- spring整合activiti插件 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;activiti-spring&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;5.22.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 导入dbcp的jar包，用来在applicationContext.xml中配置数据库 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.2.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- 格式化对象，方便输出日志 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.1.41&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- log end --&gt;</span><br><span class="line">	&lt;!--映入json--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;jackson-mapper-asl.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.8.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.8.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.8.4&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
<p>​<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 配置Activiti.cfg.xml</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line">  xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd</span><br><span class="line">       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd&quot;&gt;</span><br><span class="line">	&lt;bean id=&quot;processEngineConfiguration&quot;</span><br><span class="line">		class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span><br><span class="line">		&lt;!-- 数据库连接配置  --&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/activiti_demo?useUnicode=true&amp;amp;characterEncoding=utf8&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcPassword&quot; value=&quot;tiger&quot; /&gt;</span><br><span class="line">		&lt;!-- 建表策略 --&gt;</span><br><span class="line">		&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>初始化数据库。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">需要写一个类如下：</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateTable</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createDbByXML</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ProcessEngine processEngine = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">"activiti.cfg.xml"</span>).buildProcessEngine();</span><br><span class="line">		System.out.println(processEngine);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行方法后会自动在数据库中创建Activiti所需要的表。Activiti 5.12 有23张表，Activiti 5.22 有25张表。Activiti 6.0 有28张表。</p>
<p>​    </p>
<p>​</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/451b41a8/">Linux部分常用命令</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Linux/">Linux</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/linux/">linux</a></span><div class="content"><p>最近在阿里云是买了个ECS服务器，装的Linux系统，自己搭建了一个java web 环境，其中通过百度学习了一些linux下的常用命令，记一下；</p>
<hr>
<p>查看某个端口的占用情况</p>
<pre><code>netstat -apn|grep 端口      
</code></pre><hr>
<p>查看tomcat的进程占用情况</p>
<pre><code>ps -aux|grep tomcat         
</code></pre><hr>
<p>查看所有进程占用情况<br>​<br>​    netstat -apn                </p>
<hr>
<p>重启网络</p>
<pre><code>service network restart     
</code></pre><hr>
<p>将1.repo重命名为1.repo.backup  常用作文件备份</p>
<pre><code>mv /etc/1.repo /etc/1.repo.backup  
</code></pre><hr>
<p>查看网络信息</p>
<pre><code>ifconfig    
</code></pre><hr>
<p>使配置生效</p>
<pre><code>source /etc/profile
</code></pre><hr>
<p>查看linux内在使用情况</p>
<pre><code>free -m
</code></pre><hr>
<p>清理内存</p>
<pre><code>echo 1 &gt; /proc/sys/vm/drop_caches      
</code></pre><hr>
<p>杀进程。pid 为相应的进程号</p>
<pre><code>kill -9 pid 
</code></pre><h3 id="Mysql常用命令"><a href="#Mysql常用命令" class="headerlink" title="Mysql常用命令"></a>Mysql常用命令</h3><p>启动Mysql</p>
<pre><code>systemctl start mysqld.service      
</code></pre><hr>
<p>停止Mysql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl stop mysqld.service</span><br></pre></td></tr></table></figure>
<h3 id="tomcat-常用命令"><a href="#tomcat-常用命令" class="headerlink" title="tomcat 常用命令"></a>tomcat 常用命令</h3><p>以下命令在tomcat目录中的bin目录下执行：</p>
<pre><code>./startup.sh         启动tomcat 
./shutdown.sh        停止tomcat
</code></pre><hr>
<p>看tomcat的控制台输出</p>
<pre><code>tail -f logs/catalina.out   
</code></pre><hr>
<p>看是否已经有tomcat在运行了</p>
<pre><code>ps -ef |grep tomcat  
</code></pre><hr>
<p>查看空间分配 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">df -h</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/posts/197768c1/">Spring Secutity 自定义权限配置</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-07-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/spring/">spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/security/">security</a></span><div class="content"><blockquote>
<p>Srping Security网上也有很多例子，但基本都是所资源直接配置在XML文件里，限制太大，不够灵活。我们需要的是可以在后台修改资源访问权限，实时生效，才能符合现在大多数系统的需求。</p>
</blockquote>
<h1 id="需要引入的依赖"><a href="#需要引入的依赖" class="headerlink" title="需要引入的依赖"></a>需要引入的依赖</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- Spring security --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.2.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.2.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--Spring Security end--&gt;</span><br></pre></td></tr></table></figure>
<h1 id="用户身份认证"><a href="#用户身份认证" class="headerlink" title="用户身份认证"></a>用户身份认证</h1><blockquote>
<p>我们自定义一个实现类MUserDetailsService 来实现UserDetailsService接口。<br>其中需要实现一个loadUserByUsername方法，用来读取用户的角色。<br>在这里需要从数据库中通过用户名来查询用户的信息和用户所属的角色<br>其中MGrantedAuthority实现了GrantedAuthority接口，用于构建用户权限。<br>MUserDeatils实现了UserDeatils接口，用于存放用户信息与权限</p>
</blockquote>
<h3 id="UserDetailsService在身份认证中的作用"><a href="#UserDetailsService在身份认证中的作用" class="headerlink" title="UserDetailsService在身份认证中的作用"></a>UserDetailsService在身份认证中的作用</h3><blockquote>
<p>Spring Security中进行身份验证的是AuthenticationManager接口，ProviderManager是它的一个默认实现，但它并不用来处理身份认证，而是委托给配置好的AuthenticationProvider，每个AuthenticationProvider会轮流检查身份认证。检查后或者返回Authentication对象或者抛出异常。验证身份就是加载响应的UserDetails，看看是否和用户输入的账号、密码、权限等信息匹配。此步骤由实现AuthenticationProvider的DaoAuthenticationProvider（它利用UserDetailsService验证用户名、密码和授权）处理。包含 GrantedAuthority 的 UserDetails对象在构建 Authentication对象时填入数据。</p>
</blockquote>
<p><img src="https://wx4.sinaimg.cn/mw690/005RGBbLly1fwv4nas9raj30xo0jeae0.jpg" alt="这里写图片描述"></p>
<hr>
<h3 id="MUserDetailsService-class中的loadUserByUsername方法"><a href="#MUserDetailsService-class中的loadUserByUsername方法" class="headerlink" title="MUserDetailsService.class中的loadUserByUsername方法"></a>MUserDetailsService.class中的loadUserByUsername方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名加载用户密码与权限信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询用户信息</span></span><br><span class="line">    User user = userMapper.selectByName(username);</span><br><span class="line">    List&lt;Role&gt; roleList = <span class="keyword">null</span>;</span><br><span class="line">    MUserDeatils userDeatils = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//查询用户的角色</span></span><br><span class="line">        roleList = roleMapper.queryByUser(user.getId());</span><br><span class="line">        System.out.println(<span class="string">"user"</span> + user.getUsername() + <span class="string">"----"</span> + user.getPassword());</span><br><span class="line">        <span class="comment">// 构建权限</span></span><br><span class="line">        Set&lt;MGrantedAuthority&gt; authorities = <span class="keyword">new</span> HashSet&lt;MGrantedAuthority&gt;();</span><br><span class="line">        <span class="keyword">if</span> (roleList.size() != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (Role role: roleList)&#123;</span><br><span class="line">                authorities.add(<span class="keyword">new</span> MGrantedAuthority(role.getName()));</span><br><span class="line">                System.out.println(role.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            userDeatils = <span class="keyword">new</span> MUserDeatils(user.getUsername(),user.getPassword(),authorities);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userDeatils;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="MGrantedAuthority-class"><a href="#MGrantedAuthority-class" class="headerlink" title="MGrantedAuthority.class"></a>MGrantedAuthority.class</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MGrantedAuthority</span> <span class="keyword">implements</span> <span class="title">GrantedAuthority</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String authority;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MGrantedAuthority</span><span class="params">(String authority)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.authority = authority;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthority</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authority;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="MUserDeatils-class"><a href="#MUserDeatils-class" class="headerlink" title="MUserDeatils.class"></a>MUserDeatils.class</h3><blockquote>
<p>实现UserDetails接口定义好变量即可</p>
</blockquote>
<h1 id="读取资源与所属角色"><a href="#读取资源与所属角色" class="headerlink" title="读取资源与所属角色"></a>读取资源与所属角色</h1><blockquote>
<p>需要自定义实现类实现FilterInvocationSecurityMetadataSource接口。通过loadResourceDefine方法可以实现资源与权限的对应关系。<br>要使我们自定义的MFilterInvocationSecurityMetadataSource生效，我们还需要定义一个MyFilterSecurityInterceptor类。<br>这里的数据需要从数据库中取得。另外自定义接口UrlMatcher，实现类为AntUrlPathMatcher。</p>
</blockquote>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a><strong>坑</strong></h3><hr>
<p> 网上有教程是把loadResourceDefine方法放在了构造函数里。但我经过多次试验均出现service,mapper无法注入的问题，然后就会报一个空指针的导异常，经debug发现是service没有注入。经多次查询得知：原因是构造方法会先于注入执行，所以loadResourceDefine方法放入构造中执行时函数内的service与mapper还未执行注入，因此报 java.lang.NullPointerException的异常。解决方法是将loadResourceDefine方法放在getAttributes方法中执行。</p>
<hr>
<h3 id="MFilterInvocationSecurityMetadataSource-class"><a href="#MFilterInvocationSecurityMetadataSource-class" class="headerlink" title="MFilterInvocationSecurityMetadataSource.class"></a>MFilterInvocationSecurityMetadataSource.class</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MFilterInvocationSecurityMetadataSource</span> <span class="keyword">implements</span> <span class="title">FilterInvocationSecurityMetadataSource</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> IRescAndRoleService iRescAndRoleService ;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService iUserService ;</span><br><span class="line">    <span class="keyword">private</span> UrlMatcher urlMatcher = <span class="keyword">new</span> AntUrlPathMatcher();</span><br><span class="line">    <span class="comment">// 资源权限集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Collection&lt;ConfigAttribute&gt;&gt; resourceMap = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadResourceDefine</span><span class="params">()</span></span>&#123;</span><br><span class="line">        resourceMap = <span class="keyword">new</span> HashMap&lt;String, Collection&lt;ConfigAttribute&gt;&gt;();</span><br><span class="line">        <span class="comment">//取得用户信息</span></span><br><span class="line">        List&lt;User&gt; userList = iUserService.query();</span><br><span class="line">       <span class="comment">//取得资源与角色列表</span></span><br><span class="line">        List&lt;RescAndRole&gt; resourceList = iRescAndRoleService.query();</span><br><span class="line">        System.out.println(resourceList);</span><br><span class="line">        <span class="keyword">for</span> (RescAndRole resource : resourceList) &#123;</span><br><span class="line">            Collection&lt;ConfigAttribute&gt; atts = <span class="keyword">new</span> ArrayList&lt;ConfigAttribute&gt;();</span><br><span class="line">            atts.add(<span class="keyword">new</span> SecurityConfig(resource.getRoleName() ));</span><br><span class="line">            resourceMap.put(resource.getResString(), atts);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAttributes</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        loadResourceDefine();<span class="comment">//防止无法注入问题</span></span><br><span class="line">        <span class="comment">// guess object is a URL.</span></span><br><span class="line">        String url = ((FilterInvocation) o).getRequestUrl();</span><br><span class="line">        Iterator&lt;String&gt; ite = resourceMap.keySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (ite.hasNext()) &#123;</span><br><span class="line">            String resURL = ite.next();</span><br><span class="line">            <span class="keyword">if</span> (urlMatcher.pathMatchesUrl(resURL, url)) &#123;</span><br><span class="line">                <span class="keyword">return</span> resourceMap.get(resURL);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAllConfigAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="AntUrlPathMatcher-class"><a href="#AntUrlPathMatcher-class" class="headerlink" title="AntUrlPathMatcher.class"></a>AntUrlPathMatcher.class</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AntUrlPathMatcher</span> <span class="keyword">implements</span> <span class="title">UrlMatcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> requiresLowerCaseUrl;</span><br><span class="line">    <span class="keyword">private</span> PathMatcher pathMatcher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AntUrlPathMatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AntUrlPathMatcher</span><span class="params">(<span class="keyword">boolean</span> requiresLowerCaseUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.requiresLowerCaseUrl = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.pathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.requiresLowerCaseUrl = requiresLowerCaseUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">compile</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.requiresLowerCaseUrl) &#123;</span><br><span class="line">            <span class="keyword">return</span> path.toLowerCase();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRequiresLowerCaseUrl</span><span class="params">(<span class="keyword">boolean</span> requiresLowerCaseUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.requiresLowerCaseUrl = requiresLowerCaseUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">pathMatchesUrl</span><span class="params">(Object path, String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="string">"/**"</span>.equals(path)) || (<span class="string">"**"</span>.equals(path))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pathMatcher.match((String) path, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUniversalMatchPattern</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"/**"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">requiresLowerCaseUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.requiresLowerCaseUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getClass().getName() + <span class="string">"[requiresLowerCase='"</span></span><br><span class="line">                + <span class="keyword">this</span>.requiresLowerCaseUrl + <span class="string">"']"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="MyFilterSecurityInterceptor-class"><a href="#MyFilterSecurityInterceptor-class" class="headerlink" title="MyFilterSecurityInterceptor.class"></a>MyFilterSecurityInterceptor.class</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilterSecurityInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractSecurityInterceptor</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> FilterInvocationSecurityMetadataSource securityMetadataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                         FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        FilterInvocation fi = <span class="keyword">new</span> FilterInvocation(request, response, chain);</span><br><span class="line">        invoke(fi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterInvocationSecurityMetadataSource <span class="title">getSecurityMetadataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.securityMetadataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? extends Object&gt; getSecureObjectClass() &#123;</span><br><span class="line">        <span class="keyword">return</span> FilterInvocation.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(FilterInvocation fi)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ServletException </span>&#123;</span><br><span class="line">        InterceptorStatusToken token = <span class="keyword">super</span>.beforeInvocation(fi);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.afterInvocation(token, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityMetadataSource <span class="title">obtainSecurityMetadataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.securityMetadataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecurityMetadataSource</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            FilterInvocationSecurityMetadataSource newSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.securityMetadataSource = newSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="决策管理器"><a href="#决策管理器" class="headerlink" title="决策管理器"></a>决策管理器</h1><blockquote>
<p>自定义一个决策管理器MyAccessDecisionManager实现AccessDecisionManager接口。其中的decide方法，决定某一个用户是否有权限访问某个url</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/* (non-Javadoc)</span><br><span class="line">     * @see org.springframework.security.access.AccessDecisionManager#decide(org.springframework.security.core.Authentication, java.lang.Object, java.util.Collection)</span><br><span class="line">     * 该方法决定该权限是否有权限访问该资源，其实object就是一个资源的地址，authentication是当前用户的</span><br><span class="line">     * 对应权限，如果没登陆就为游客，登陆了就是该用户对应的权限</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void decide(Authentication authentication, Object object,</span><br><span class="line">                       Collection&lt;ConfigAttribute&gt; configAttributes)</span><br><span class="line">            throws AccessDeniedException, InsufficientAuthenticationException &#123;</span><br><span class="line">        if(configAttributes == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(object.toString()); // object is a URL.</span><br><span class="line">        //所请求的资源拥有的权限(一个资源对多个权限)</span><br><span class="line">        Iterator&lt;ConfigAttribute&gt; iterator = configAttributes.iterator();</span><br><span class="line">        while(iterator.hasNext()) &#123;</span><br><span class="line">            ConfigAttribute configAttribute = iterator.next();</span><br><span class="line">            //访问所请求资源所需要的权限</span><br><span class="line">            String needPermission = configAttribute.getAttribute();</span><br><span class="line">            System.out.println(&quot;访问&quot;+object.toString()+&quot;需要的权限是：&quot; + needPermission);</span><br><span class="line">            //用户所拥有的权限authentication</span><br><span class="line">            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();</span><br><span class="line">            for(GrantedAuthority ga : authorities) &#123;</span><br><span class="line">                if(needPermission.equals(ga.getAuthority())) &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //没有权限</span><br><span class="line">        throw new AccessDeniedException(&quot; 没有权限访问！ &quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(ConfigAttribute attribute) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(Class&lt;?&gt; clazz) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="配置XML"><a href="#配置XML" class="headerlink" title="配置XML"></a>配置XML</h1><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><blockquote>
<p>添加Seucrity的过滤器，将拦截所有资源访问</p>
</blockquote>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a><strong>注意</strong></h3><pre><code>只能配置成 /*
</code></pre><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--加载Security配置文件与mybatis配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">        WEB-INF/config/security.xml</span><br><span class="line">        WEB-INF/config/spring-mybatis.xml</span><br><span class="line">    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring security 的过滤器配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="spring-security-xml"><a href="#spring-security-xml" class="headerlink" title="spring-security.xml"></a>spring-security.xml</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">b:beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/security"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:b</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--登陆页面不验证--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/userLogin.html"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--静态文件请求不验证--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/js/**"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/css/**"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--restful请求--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/login"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/getGrid"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--浏览器会自动请求网站图标：favicon.ico -不验证  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> <span class="attr">pattern</span>=<span class="string">"/favicon.ico"</span> <span class="attr">security</span>=<span class="string">"none"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">http</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--自定义权限不足时显示的页面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">access-denied-handler</span> <span class="attr">error-page</span>=<span class="string">"/accessHint.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">access-denied-handler</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 自定义登录界面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form-login</span></span></span><br><span class="line"><span class="tag">                <span class="attr">authentication-failure-url</span>=<span class="string">"/userLogin.html?error=true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">login-page</span>=<span class="string">"/userLogin.html"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">default-target-url</span>=<span class="string">"/index.html"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">login-processing-url</span>=<span class="string">"/j_spring_security_check"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logout</span> <span class="attr">invalidate-session</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">logout-success-url</span>=<span class="string">"/userLogin.html"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">logout-url</span>=<span class="string">"/j_spring_security_logout"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过配置custom-filter来增加过滤器，before="FILTER_SECURITY_INTERCEPTOR"表示在SpringSecurity默认的过滤器之前执行。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">custom-filter</span> <span class="attr">ref</span>=<span class="string">"filterSecurityInterceptor"</span> <span class="attr">before</span>=<span class="string">"FILTER_SECURITY_INTERCEPTOR"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">csrf</span> <span class="attr">disabled</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 认证过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b:bean</span> <span class="attr">id</span>=<span class="string">"filterSecurityInterceptor"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"com.hand.security.utils.MyFilterSecurityInterceptor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b:property</span> <span class="attr">name</span>=<span class="string">"rejectPublicInvocations"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用户拥有的权限 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b:property</span> <span class="attr">name</span>=<span class="string">"accessDecisionManager"</span> <span class="attr">ref</span>=<span class="string">"accessDecisionManager"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用户是否拥有所请求资源的权限 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b:property</span> <span class="attr">name</span>=<span class="string">"authenticationManager"</span> <span class="attr">ref</span>=<span class="string">"authenticationManager"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 资源与权限对应关系 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b:property</span> <span class="attr">name</span>=<span class="string">"securityMetadataSource"</span> <span class="attr">ref</span>=<span class="string">"securityMetadataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">b:bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、更改验证信息加载方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">authentication-manager</span> <span class="attr">alias</span>=<span class="string">"authenticationManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">authentication-provider</span></span></span><br><span class="line"><span class="tag">                <span class="attr">user-service-ref</span>=<span class="string">"mUserDetailsService"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--如果用户的密码采用加密的话 &lt;password-encoder hash="md5" /&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">authentication-provider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">authentication-manager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1、配置自定义类MUserDetailsService --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b:bean</span> <span class="attr">id</span>=<span class="string">"mUserDetailsService"</span> <span class="attr">class</span>=<span class="string">"com.hand.security.service.impl.MUserDetailsService"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--访问决策器，决定某个用户具有的角色，是否有足够的权限去访问某个资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b:bean</span> <span class="attr">id</span>=<span class="string">"accessDecisionManager"</span> <span class="attr">class</span>=<span class="string">"com.hand.security.utils.MyAccessDecisionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">b:bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--资源源数据定义，将所有的资源和权限对应关系建立起来，即定义某一资源可以被哪些角色访问 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b:bean</span> <span class="attr">id</span>=<span class="string">"securityMetadataSource"</span> <span class="attr">class</span>=<span class="string">"com.hand.security.utils.MFilterInvocationSecurityMetadataSource"</span> &gt;</span><span class="tag">&lt;/<span class="name">b:bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">b:beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By HJW</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>